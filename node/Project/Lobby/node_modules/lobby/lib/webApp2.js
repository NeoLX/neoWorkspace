'use strict'

var fs = require('fs');
var pathHelper = require("path");
var util = require('util');
var express = require('express');
var context = require('context');
var lobbyUtil = require('lobbyUtil');
var appbase = require('./appBase2.js');

var WebApp = function(name, path){
    appbase.call(this,name);
    // this.__proto__.constructor(name, path);
    this._router = express.Router();

    this._config;    

    if(!path
        || !(typeof path == 'string')){
        console.log(`[WEBAPP_CONFIG_UNAVAILABLE]`);
        return;
    }else{
        if(path){
            
            if(path.charAt(path.length) != '/'){
                path += '/';
            }
        }
        this._config = lobbyUtil.readConfigFile(path + "web.json");

        try{
            this._config = JSON.parse(this._config);
        }catch(e){
            console.log(`[WEBAPP CONFIG FILE UNAVAILABLE]`);
            return;
        }
    }

    //添加静态路由
    if(this._config.static && this._config.static instanceof Array){

        for(var n in this._config.static){
            var staticConf = this._config.static[n];

            if(staticConf.reqPath){
                this._router.use(staticConf.reqPath, express.static(path + staticConf.filePath));
            }else{
                this._router.use(express.static(path + staticConf.filePath));
            }
        }
    }
}
util.inherits(WebApp, appbase);

WebApp.prototype.getRouter = function(){
    return this._router;
};

WebApp.Status = {};
WebApp.Status.Inited = "WEB_CONFIG_INITED";

var web = new WebApp("neotest", "D:/my git/neoWorkspace/node/Project/Lobby/webcontent/lobby_manager");
var app = express();
app.use("/", web.getRouter());
app.listen(8080);